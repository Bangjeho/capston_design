package kr.ac.sunmoon.client;

import java.util.ArrayList;

import com.google.gwt.core.client.EntryPoint;
import com.google.gwt.core.client.GWT;
import com.google.gwt.event.dom.client.ClickEvent;
import com.google.gwt.event.dom.client.ClickHandler;
import com.google.gwt.user.client.Window;
import com.google.gwt.user.client.rpc.AsyncCallback;
import com.google.gwt.user.client.ui.Button;
import com.google.gwt.user.client.ui.HTML;
import com.google.gwt.user.client.ui.RootPanel;
import com.google.gwt.user.client.ui.VerticalPanel;

import kr.ac.sunmoon.shared.RoomInfo;

/**
 * Entry point classes define <code>onModuleLoad()</code>.
 */
public class Test implements EntryPoint 
{
	 private native void initMapFromGWT(double lat, double lng, double[][] paramGeos, String[] group)
	   /*-{
	      $wnd.initMap(lat, lng, paramGeos, group);
	   }-*/;

	
	public void onModuleLoad() 
	{
		VerticalPanel vp = new VerticalPanel();
		RootPanel.get('main').add(vp);
		Button btnMap = new Button("click");
		vp.add(btnMap);
		btnMap.addClickHandler(new ClickHandler() {
			
			@Override
			public void onClick(ClickEvent event) {
				// TODO Auto-generated method stub
				ServiceAsync service = GWT.create(Service.class);
				service.getRoomInfo(new AsyncCallback<ArrayList<RoomInfo>>() {
					
					@Override
					public void onSuccess(ArrayList<RoomInfo> result) {
						// TODO Auto-generated method stub
						String[] group = new String[result.size()];
						double[][] paramGeos = new double[result.size()][];
						for(int i=0; i<paramGeos.length; i++)
						{
							group[i] = result.get(i).getGroup();
							paramGeos[i] = new double[2];
							paramGeos[i][0] = result.get(i).getLatitude();
							paramGeos[i][1] = result.get(i).getLongitude();
						}
						initMapFromGWT(37.5536,126.9696, paramGeos,group);
					}
					
					@Override
					public void onFailure(Throwable caught) {
						// TODO Auto-generated method stub
						
					}
				});
			}
		});
	    HTML html = new HTML("<div id='map' style ='width :500px;height:500px;'></div>");
	    vp.add(html);
	}
}
